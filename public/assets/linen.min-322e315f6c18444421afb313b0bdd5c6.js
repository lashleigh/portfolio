var linen=function(){function a(a){function c(a){return a=function(a){var a=a.split("\n"),c=[],d;for(d in a){var e=/^(\*+|#+)(.*)/.exec(a[d]);if(e){types={"*":"ul","#":"ol"};var f=b(e[2]);c.push({type:types[e[1][0]],indent:e[1].length,content:f.content,attrs:f.attrs})}}return c}(a),{type:a[0].type,extended:!1,attrs:[],content:a}}function d(a){var a=a.split("\n"),c=[],d,e;for(e in a){var f=a[e].replace(/^\|/,"").replace(/\|$/,""),g=b(f[0]);f[0]=g.content,e==0&&(d=g.attrs),c.push(f.split("|"))}return{type:"table",extended:!1,attrs:d,content:c}}function e(a){function e(a){var b=["h1","h2","h3","h4","h5","h6","pre","bq","fn","p","bc","pre","table","ul","ol"],c;for(c in b)if(b[c]==a)return!0;return!1}var f="",g=0,h=a[0];return h=="f"&&a[g+1]=="n"&&(f="fn",g++),h!="*"&&h!="#"||!/^\s+/.exec(b(a.slice(1)).content)?h=="|"?d(a):(h=="b"&&(f="b"+a[++g]),h=="h"&&(f="h"+a[++g]),h=="p"&&(a.slice(g,g+3)=="pre"?(g+=2,f="pre"):f="p"),g++,g=b(a.slice(g,a.length)),(h=/^(\.+ )/.exec(g.content))&&e(f)?(g.type=f,g.content=g.content.replace(/^(\.+ )/,""),g.extended=h[1]==".. ",g.noBlock=!1):(g.type="p",g.content=a,g.extended=!1,g.noBlock=!0),g):c(a)}var a=a.split(/\n\n+/),f=[],g;for(g in a){var h=e(a[g]);h&&f.push(h)}return f}function b(a){for(var b=[],c=a.match(/^<\S+[^<>]*>/)!==null,d=0;d<a.length;d++){var e=a[d];if(e==">")b.push(">");else if(e=="=")b.push("=");else if(e=="<"&&!c)a[d+1]==">"?(d++,b.push("<>")):b.push("<");else if(e=="("){for(e=d;a[d++]!==")"&&d<a.length;);b.push(a.slice(e,d--))}else if(e=="["){for(e=d;a[d++]!=="]"&&d<a.length;);b.push(a.slice(e,d--))}else{if(e!="{")break;for(e=d;a[d++]!=="}"&&d<a.length;);b.push(a.slice(e,d--))}}return{attrs:b,content:a.slice(d,a.length)}}function c(a){function c(a,c,d){var d=typeof d=="undefined"?"":" "+d,c=b(c),g=e(c.attrs);return"<"+a+f({attrs:g})+d+">"+c.content+"</"+a+">"}function d(a,b){return typeof b=="undefined"&&(b=1),a.slice(b,a.length-b)}return a.replace(/(\s)"(.*?)"([^:])/g,"$1&#8220;$2&#8221;$3").replace(/"([^"]+)":(http\S+)/g,function(a,b,d){return d[d.length-1]=="."?c("a",b,'href="'+d.slice(0,d.length-1)+'"')+".":c("a",b,'href="'+d+'"')}).replace(/!\b([^! \n]+)\b!:(http\S+)/g,function(a,b,d){return c("a"," "+c("img","",'src="'+b+'"'),'href="'+d+'"')}).replace(/!([^! \n]+)!/g,function(a){return c("img","",'src="'+d(a)+'"')}).replace(/--/g,"&#8212;").replace(/\n/g,"<br/>").replace(/(\b)'([^']*)'(\b)/g,"$1&#8216;$2&#8217;$3").replace(/'/g,"&#8217;").replace(/ - /g," &#8211; ").replace(/\.\.\./g,"&#8230;").replace(/\(r\)/g,"&#174;").replace(/\(tm\)/g,"&#8482;").replace(/\(c\)/g,"&#169;").replace(/([A-Z]{2,})\(([^)]+)\)/g,'<span class="caps"><acronym title="$2">$1</acronym></span>').replace(/([A-Z]{2,})/g,function(a){return c("span",a+" ",'class="caps"')}).replace(/\?{2}([^\?]+)\?{2}/g,function(a){return c("cite",d(a))}).replace(/%([^%]+)%/g,function(a){return c("span",d(a))}).replace(/(@[^@]+@)/g,function(a){return c("code",d(a))}).replace(/\*([^\*]+)\*/g,function(a){return c("strong",d(a))}).replace(/\*\*([^\*]+)\*\*/g,function(a){return c("b",d(a))}).replace(/\b_([^_]+)_\b/g,function(a){return c("em",d(a))}).replace(/\b__([^_]+)__\b/g,function(a){return c("i",d(a))}).replace(/\s\+([^\+]+)\+\s/g,function(a){return" "+c("ins",d(a,2))+" "}).replace(/\s-([^-]+)-\s/g,function(a){return" "+c("del",d(a,2))+" "}).replace(/\^([^\^]+)\^/g,function(a){return c("sup",d(a))}).replace(/~([^~]+)~/g,function(a){return c("sub",d(a))})}function d(a){function b(a){for(var b=a.content,d=1,f=[],g=f,h=[],i=0;i<b.length;i++){var j=b[i];j.content=c(j.content),j.attrs=e(j.attrs);if(j.indent>d)for(var l=0;l<j.indent-d;l++){h.push(g);var m=[];g.push(m),g=m}if(j.indent<d)for(l=0;l<d-j.indent;l++)g=h.pop();g.push(j),d=j.indent}return{type:a.type,content:f,attrs:f[0].attrs,classes:"",id:"",lang:"",style:"",alignment:""}}var d=[],f;for(f in a)d.push(a[f].type=="ol"||a[f].type=="ul"?b(a[f]):a[f].type=="table"?{type:"table",attrs:e(a[f].attrs),content:a[f].content,classes:"",id:"",lang:"",style:"",alignment:""}:a[f].type=="bc"?{type:a[f].type,content:a[f].content.replace(/</g,"&#60;").replace(/>/g,"&#62;").replace(/"/g,"&#34;"),attrs:e(a[f].attrs)}:{type:a[f].type,content:c(a[f].content),attrs:e(a[f].attrs)});return d}function e(a){var b={classes:"",id:"",lang:"",style:"",alignment:""},c;for(c in a){var d=a[c];if(d[0]=="("){if(d=d.replace(/^\(/,"").replace(/\)$/,"").split("#"),b.classes=b.classes==""?d[0]:b.classes+" "+d[0],d.length>1&&b.id=="")b.id=d[1]}else d[0]=="["?b.lang=d.replace(/^\[/,"").replace(/\]$/,""):d[0]=="{"?b.style=d.replace(/^\{/,"").replace(/\}$/,""):b.alignment==""&&(d==">"&&(b.alignment="right"),d=="<"&&(b.alignment="left"),d=="="&&(b.alignment="center"),d=="<>"&&(b.alignment="justify"))}return b}function f(a){var b=" ",a=a.attrs;return a.classes&&(b+='class="'+a.classes+'" '),a.id&&(b+='id="'+a.id+'" '),a.align&&(a.style="text-align: "+a.align+"; "+a.style),a.style&&(b+='style="'+a.style+'" '),a.lang&&(b+='lang="'+a.lang+'" '),b.slice(0,b.length-1)}function g(a){function b(a){function b(a){var b="<table"+f(a)+">",c;for(c in a.content){var d=a.content[c];b+="<tr>";for(var e in d)b+="<td>"+d[e]+"</td>";b+="</tr>"}return b+="</table>",b}function c(a){function b(a){var c="<"+a[0].type+f(a[0])+">",d;for(d in a){var e=a[d];e.type?(c+="<li>"+e.content,a[d+1]&&a[d+1].type==void 0&&(c+=b(a[++d])),c+="</li>"):c+=b(e)}return c+="</"+a[0].type+">",c}return b(a.content)}switch(a.type){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return"<"+a.type+f(a)+">"+a.content+"</"+a.type+">";case"bq":return"<blockquote"+f(a)+"><p>"+a.content+"</p></blockquote>";case"fn":return"<p"+f(a)+"><sup>"+a.number+"</sup>"+a.content+"</p>";case"p":return"<p"+f(a)+">"+a.content+"</p>";case"bc":return"<pre"+f(a)+"><code>"+a.content+"</code></pre>";case"pre":return"<pre"+f(a)+">"+a.content+"</pre>";case"table":return b(a);case"ul":case"ol":return c(a)}}ret="";for(var c in a)ret+=b(a[c])+"\n";return ret}return function(b){return g(d(a(b)))}}();typeof exports!="undefined"&&(exports.linen=linen,exports.textilize=linen);