<script type="text/javascript">
  var slideshow;
  var code_editor;
  var show_editor;
  $(function() {
    code_editor = CodeMirror(document.body, {
      mode:  "javascript",
      matchBrackets: true
    })
    slideshow = create_slideshow(<%= @show.to_json(:methods => :ordered_slides).html_safe %>);
    autocomplete(code_editor, slideshow);
    rescale();
    $(window).resize( function() {
      rescale();
      slideshow.scale_all_slides();
    })
    function rescale() {
      var scale = Math.max(slideshow.width/window.innerWidth, slideshow.height/window.innerHeight);
      $("#scale_slides").attr("max", 100*(1/scale));
      $("#scale_slides").attr("min", 100*scale*0.25);
    }
  })
</script>

<%= render :partial => 'slides/slide', :collection => @show.ordered_slides %>

<%= form_for(@show, :remote => true) do |f|%>
  <%= f.hidden_field :scripts %>
  <%= f.hidden_field :styles %>
  <%= f.submit %>
<% end %>

<%= form_for(Slide.new, :remote => true) do |f|%>
  <%= hidden_field_tag :show_id, @show.id %>
  <%= hidden_field_tag :insert_id  %>
  <%= hidden_field_tag :copy  %>
<% end %>
