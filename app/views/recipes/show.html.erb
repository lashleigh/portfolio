<div id="recipe_container"> </div>

<script type="text/javascript">
  var Recipe;
  var ingredients = <%= @ingredients.to_json.html_safe %>;
  $(function() {
    // By default, Underscore uses ERB-style template delimiters, this change
    // makes it use mustache style.
    _.templateSettings = {
      interpolate : /\{\{([\s\S]+?)\}\}/g
    };
    Recipe = new App.Models.Recipe(<%= @recipe.to_json(:include => {:parts => {:include => {:ingredient => {:only => :name}}}} ).html_safe %>);

    $( "#new-name" ).autocomplete({
      minLength: 0,
      source: ingredients,
      focus: function( event, ui ) {
        $( "#new-name" ).val( ui.item.label );
        return false;
      },
      select: function( event, ui ) {
        $( "#new-name" ).val( ui.item.label );
        $( "#new-name-id" ).val( ui.item.value );

        return false;
      }
    })
    $.ui.autocomplete.prototype._renderItem = function( ul, item ) {
      return $( "<li></li>" )
        .data( "item.autocomplete", item )
        .append( "<a>" + item.label + "</a>" )
        .appendTo( ul );
    };
  });
</script>

<script type="text/template" id="recipe-li">
  <a href='/recipes/{{id}}' class="title">
    {{title}}
  </a>
  <table>
    <tbody id="part-list">
    </tbody>
  <tfoot>
    <tr>
      <td class="amount-col"> <input class="new-amount" placeholder="12" /> </td>
      <td class="unit-col">
        <select class="new-unit">
          <option value='g'>g</option>
          <option value='oz'>oz</option>
          <option value='ml'>ml</option>
          <option value='c'>c</option>
          <option value='t'>t</option>
          <option value='T'>T</option>
        </select>
      </td>
      <td class="name-col"> 
        <input id="new-name" placeholder="salt" /> 
        <input id="new-name-id" type="hidden" /> 
      </td>
      <td class="button-col"> <button class='icon icononly add button'></button> </td>
    </tr>
  </tfoot>
  </table>
  <span class="stats"> </span>
</script>

<script type="text/template" id="primary-part-li">
  <td class='amount-col'>
    <span class="amount"> {{amount}} </span>
    <input class="edit-amount hidden" value={{amount}} />
  </td>
  <td class='unit-col'>
    <span class="unit">{{unit}}</span>
    <select class="edit-unit hidden">
      <option value='g'>g</option>
      <option value='oz'>oz</option>
      <option value='ml'>ml</option>
      <option value='c'>c</option>
      <option value='t'>t</option>
      <option value='T'>T</option>
    </select>
  </td>
  
  <td class='name-col'>
    <span class="primary-name"> {{ingredient.name}} </span>
  </td>
  <td class='bakers-percent-col'>
  </td>
  <td class='button-col'>
  </td>

</script>
<script type="text/template" id="part-li">
  <td class='amount-col'>
    <span class="amount"> {{amount}} </span>
    <input class="edit-amount hidden" value={{amount}} />
  </td>

  <td class='unit-col'>
    <span class="unit">{{unit}}</span>
    <select class="edit-unit hidden">
      <option value='g'>g</option>
      <option value='oz'>oz</option>
      <option value='ml'>ml</option>
      <option value='c'>c</option>
      <option value='t'>t</option>
      <option value='T'>T</option>
    </select>
  </td>
  
  <td class='name-col'>
    <span class="name"> {{ingredient.name}} </span>
    <input class="edit-name hidden" value={{ingredient.name}} />
    <input class="edit-name-id" type="hidden" value={{ingredient_id}} />
  </td>
  <td class='bakers-percent-col'>
    <span class="bakers-percent">{{percent}}</span>
  </td>
  <td class='button-col'>
    <button class='icon icononly remove danger button'></button>
  </td>
</script>

<script type="text/template" id="recipe-stats">
  <div>
    <span class="hydration"> {{hydration}}</span>% hydration
    <input class="edit-hydration hidden" value={{hydration}} />
  </div>
  <div>
    <span class="innoculation"> {{innoculation}}</span>% innoculation
    <input class="edit-innoculation hidden" value={{innoculation}} />
  </div>
  <div class="timing">
    Doubled in 
    <span class="doubling"> {{doubling}} </span> hrs 
    <input class="edit-doubling hidden" value={{doubling}} />
    at 
    <span class="temp"> {{temp}} </span>
    <input class="edit-temp hidden" value={{temp}} />
    degrees F
  </div>
</script>
